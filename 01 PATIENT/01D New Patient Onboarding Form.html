<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>SFRD Patient Onboarding & Health Information Form</title>
    <link rel="icon" href="../../public/Logo_SFRD.jpg" type="image/jpeg">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/tributejs/dist/tribute.css" />
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .form-section {
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            margin-bottom: 2rem;
            padding: 1.5rem;
        }
        .form-section-header {
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 1rem;
            margin-bottom: 1.5rem;
        }
        .form-label {
            font-weight: 500;
            margin-bottom: 0.5rem;
            display: block;
        }
        .form-input, .form-select, .form-textarea {
            width: 100%;
            border-radius: 0.375rem;
            border: 1px solid #d1d5db;
            padding: 0.5rem 0.75rem;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: 2px solid transparent;
            outline-offset: 2px;
            border-color: #4f46e5;
            box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.5);
        }
        .helper-text {
            color: #6b7280;
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }
        .submit-button {
            background-color: #4f46e5;
            color: white;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .submit-button:hover {
            background-color: #4338ca;
        }


    </style>
</head>
<body class="bg-gray-50">
    <div class="max-w-4xl mx-auto p-4 sm:p-6 lg:p-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-900">SFRD Patient Onboarding & Health Information Form</h1>
            <p class="mt-4 text-sm text-gray-600">Please fill all details in the form at once.</p>
        </header>




        <form id="patientOnboardingForm">

            <!-- Section A: Referee Details -->
            <div class="form-section">
                <div class="form-section-header">
                    <h2 class="text-xl font-semibold text-gray-800">Section A: Referee Details</h2>
                    <p class="text-gray-600 mt-1">This section helps us understand who has referred the patient to SFRD. All personal contact information will be kept strictly confidential and will only be used by the SFRD support team to contact them.</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="referredBy" class="form-label">Referred by <span class="text-red-500">*</span></label>
                        <select id="referredBy" name="referredBy" class="form-select" required>
                            <option>Self</option>
                            <option>Volunteer</option>
                            <option>NGOs</option>
                            <option>Doctor</option>
                            <option>Genetic Counsellor</option>
                            <option>Diagnostics Lab</option>
                            <option>Hospital</option>
                            <option>Others</option>
                        </select>
                    </div>
                    <div>
                        <label for="refereeId" class="form-label">Unique ID of Referee (if already part of SFRD)</label>
                        <input type="text" id="refereeId" name="refereeId" class="form-input">
                    </div>
                    <div>
                        <label for="refereeDetails" class="form-label">Details of Referee <span class="text-red-500">*</span></label>
                        <input type="text" id="refereeDetails" name="refereeDetails" class="form-input" placeholder="Enter referee's name, profession, and location" required>
                    </div>
                    <div>
                        <label for="refereeContact" class="form-label">Contact Phone/WhatsApp of Referee <span class="text-red-500">*</span></label>
                        <input type="tel" id="refereeContact" name="refereeContact" class="form-input" placeholder="Enter referee's contact number" required>
                        <p class="helper-text">Our support team will use this number to contact him.</p>
                    </div>
                </div>
            </div>

            <!-- Section B: Patient's Basic Information -->
<div class="form-section">
    <div class="form-section-header">
        <h2 class="text-xl font-semibold text-gray-800">Section B: Patient's Basic Information</h2>
        <p class="text-gray-600 mt-1">This section helps us understand who the patient is. All personal contact information will be kept strictly confidential and will only be used by the SFRD support team to contact you.</p>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
         <div>
            <label for="firstName" class="form-label">First Name <span class="text-red-500">*</span></label>
            <input type="text" id="firstName" name="firstName" class="form-input" placeholder="Enter patient's first name" required>
             <p class="helper-text">As it appears on official documents.</p>
        </div>
        <div>
            <label for="lastName" class="form-label">Last Name <span class="text-red-500">*</span></label>
            <input type="text" id="lastName" name="lastName" class="form-input" placeholder="Enter patient's last name" required>
            <p class="helper-text">As it appears on official documents.</p>
        </div>
        <div>
            <label for="dob" class="form-label">Date of Birth <span class="text-red-500">*</span></label>
            <input type="date" id="dob" name="dob" class="form-input" required>
            <p class="helper-text">Please use the DD-MM-YYYY format.</p>
        </div>
        <div>
            <label for="age" class="form-label">Age at Enrolment</label>
            <input type="number" id="age" name="age" class="form-input" placeholder="e.g., 12">
        </div>
         <div>
            <label for="gender" class="form-label">Gender <span class="text-red-500">*</span></label>
            <select id="gender" name="gender" class="form-select" required>
                <option value="">Select Gender</option>
                <option value="1">Male</option>
                <option value="2">Female</option>
                <option value="0">Not Known</option>
                <option value="9">Not Applicable</option>
            </select>
        </div>
        <div>
            <label for="country" class="form-label">Country of Residence <span class="text-red-500">*</span></label>
            <select id="country" name="country" class="form-select" required>
                <option value="">Select Country</option>
                <option value="IN">India</option>
                <!-- Add other countries as needed -->
            </select>
        </div>
         <div>
            <label for="state" class="form-label">State <span class="text-red-500">*</span></label>
            <input type="text" id="state" name="state" class="form-input" placeholder="Enter state" required>
        </div>
        <div>
            <label for="city" class="form-label">City/Town/Village <span class="text-red-500">*</span></label>
            <input type="text" id="city" name="city" class="form-input" placeholder="Enter city/town/village" required>
        </div>
        <div>
            <label for="patientStatus" class="form-label">Patient's Current Status <span class="text-red-500">*</span></label>
            <select id="patientStatus" name="patientStatus" class="form-select" required>
                <option value="">Select Status</option>
                <option>Alive</option>
                <option>Deceased</option>
            </select>
        </div>
         <div>
            <label for="email" class="form-label">Contact Email</label>
            <input type="email" id="email" name="email" class="form-input" placeholder="Enter a valid email address">
             <p class="helper-text">We will use this to send you updates and connect you with resources.</p>
        </div>
        <div>
            <label for="phone" class="form-label">Contact Phone/WhatsApp <span class="text-red-500">*</span></label>
            <input type="tel" id="phone" name="phone" class="form-input" placeholder="Enter a 10-digit mobile number" required>
            <p class="helper-text">Our support team will use this number to contact you.</p>
        </div>
         <div>
            <label for="socialMedia" class="form-label">Social Media Handles (if any)</label>
            <input type="text" id="socialMedia" name="socialMedia" class="form-input" placeholder="Facebook / Instagram / Twitter / LinkedIn">
             <p class="helper-text">Our support team will use these handles to share know how on RDs, updates etc.</p>
        </div>
         <div>
            <label for="patientId" class="form-label">Unique Patient Identifier</label>
            <input type="text" id="patientId" name="patientId" class="form-input bg-gray-100" readonly>
             <p class="helper-text">Your permanent identification no in SFRD. Quote this for all support/help.</p>
        </div>
    </div>
</div>

<!-- Section C: Parental Information -->
<div class="form-section">
    <div class="form-section-header">
        <h2 class="text-xl font-semibold text-gray-800">Section C: Parental Information Medical History</h2>
        <p class="text-gray-600 mt-1">This section helps us reach out to parents / caregivers for all future activities.</p>
    </div>
     <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
            <label for="parentFirstName" class="form-label">First Name <span class="text-red-500">*</span></label>
            <input type="text" id="parentFirstName" name="parentFirstName" class="form-input" placeholder="Enter parent/guardian's first name" required>
            <p class="helper-text">As it appears on official documents.</p>
        </div>
        <div>
            <label for="parentLastName" class="form-label">Last Name <span class="text-red-500">*</span></label>
            <input type="text" id="parentLastName" name="parentLastName" class="form-input" placeholder="Enter parent/guardian's last name" required>
            <p class="helper-text">As it appears on official documents.</p>
        </div>
        <div>
            <label for="relationToPatient" class="form-label">Relation to Patient <span class="text-red-500">*</span></label>
            <select id="relationToPatient" name="relationToPatient" class="form-select" required>
                <option value="">Select Relationship</option>
                <option>Mother</option>
                <option>Father</option>
                <option>Guardian</option>
                <option>Other</option>
            </select>
        </div>
        <div>
            <label for="parentPhone" class="form-label">Contact Phone/WhatsApp <span class="text-red-500">*</span></label>
            <input type="tel" id="parentPhone" name="parentPhone" class="form-input" placeholder="Enter parent/guardian's contact number" required>
            <p class="helper-text">Our support team will use this number to contact you.</p>
        </div>
    </div>
</div>
            
            <!-- Section D: Symptoms & Clinical Features -->
            <div class="form-section">
                <div class="form-section-header">
                    <h2 class="text-xl font-semibold text-gray-800">Section D: Symptoms & Clinical Features (Phenotype)</h2>
                     <p class="text-gray-600 mt-1">Please help us understand the patient's health challenges better. Describe the symptoms or features you have observed, even if they seem unrelated.</p>
                </div>
                 <div class="grid grid-cols-1 gap-6">
                     <div>
                        <label for="growthDevelopment" class="form-label">Overall Growth & Development</label>
                        <textarea id="growthDevelopment" name="growthDevelopment" rows="4" class="form-textarea"></textarea>
                         <p class="helper-text">Describe any issues with height, weight, head size, or delays in milestones like walking or talking.</p>
                    </div>
                    <div>
                        <label for="neurological" class="form-label">Neurological (Brain & Nerves)</label>
                        <textarea id="neurological" name="neurological" rows="4" class="form-textarea"></textarea>
                         <p class="helper-text">Mention any seizures, muscle weakness, difficulty with balance/coordination, or learning difficulties. Include cognitive /neuro functions.</p>
                    </div>
                    <div>
                        <label for="skeletal" class="form-label">Skeletal (Bones & Joints)</label>
                        <textarea id="skeletal" name="skeletal" rows="4" class="form-textarea"></textarea>
                         <p class="helper-text">Describe any unusual bone shape, frequent fractures, joint stiffness, or scoliosis (curved spine).</p>
                    </div>
                    <div>
                        <label for="cardiovascular" class="form-label">Cardiovascular (Heart & Blood)</label>
                        <textarea id="cardiovascular" name="cardiovascular" rows="4" class="form-textarea"></textarea>
                         <p class="helper-text">Mention any known heart defects, irregular heartbeat, or bleeding/clotting problems.</p>
                    </div>
                     <div>
                        <label for="eyesVision" class="form-label">Eyes & Vision</label>
                        <textarea id="eyesVision" name="eyesVision" rows="4" class="form-textarea"></textarea>
                         <p class="helper-text">Describe any issues like cataracts, poor vision, or unusual eye movements.</p>
                    </div>
                    <div>
                        <label for="otherSymptoms" class="form-label">Other Major Symptoms</label>
                        <textarea id="otherSymptoms" name="otherSymptoms" rows="4" class="form-textarea" data-autocomplete="symptoms"></textarea>
                         <p class="helper-text">Start typing a symptom. We will suggest matches. You can add multiple symptoms.</p>
                    </div>
                     <div>
                        <label for="physicalFunctioning" class="form-label">Physical Functioning</label>
                        <textarea id="physicalFunctioning" name="physicalFunctioning" rows="4" class="form-textarea"></textarea>
                         <p class="helper-text">Please describe physical mobility, daily activity support, school /work participation / support of parents in daily routines.</p>
                    </div>
                </div>
            </div>

            <!-- Section E: Diagnosis Information -->
<div class="form-section">
    <div class="form-section-header">
        <h2 class="text-xl font-semibold text-gray-800">Section E: Diagnosis Information</h2>
         <p class="text-gray-600 mt-1">This is the most important section. Please provide as much detail as you can about the patient's diagnosis. If you are unsure, please write 'Don't Know' or upload a doctor's report. Can seek support of patient-onboarding team to fulfil this section.</p>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
            <label for="diagnosisStatus" class="form-label">Diagnosis Status <span class="text-red-500">*</span></label>
            <select id="diagnosisStatus" name="diagnosisStatus" class="form-select" required>
                <option value="">Select Status</option>
                <option>Confirmed</option>
                <option>Suspected</option>
            </select>
             <p class="helper-text">Has a doctor confirmed the diagnosis?</p>
        </div>
        <div>
            <label for="diseaseName" class="form-label">Name of the Disease/Condition <span class="text-red-500"></span></label>
            <input type="text" id="diseaseName" name="diseaseName" class="form-input" data-autocomplete="diseases" placeholder="Start typing disease name..." >
             <p class="helper-text">Start typing a disease name. We will suggest matches from our database.</p>
            <input type="hidden" id="orphaCodeHidden" name="orphaCodeHidden">
        </div>
         <div>
            <label for="orphaCode" class="form-label">ORPHA Code (if known)</label>
            <input type="text" id="orphaCode" name="orphaCode" class="form-input" placeholder="e.g., 12345">
             <p class="helper-text">This is a specific code for a rare disease. You can find it on a genetic report or ask your doctor.</p>
        </div>
        <div>
            <label for="firstSymptomsDate" class="form-label">Date of First Symptoms <span class="text-red-500">*</span></label>
            <input type="date" id="firstSymptomsDate" name="firstSymptomsDate" class="form-input" required>
             <p class="helper-text">When did you first notice symptoms, even if you didn't know the cause?</p>
        </div>
        <div>
            <label for="firstDiagnosisDate" class="form-label">Date of First Diagnosis</label>
            <input type="date" id="firstDiagnosisDate" name="firstDiagnosisDate" class="form-input">
             <p class="helper-text">The date a doctor first gave you this specific diagnosis.</p>
        </div>
         <div>
            <label class="form-label">How was the diagnosis made?</label>
            <div class="flex flex-col space-y-2">
                <label class="inline-flex items-center"><input type="checkbox" name="diagnosisMethod" value="clinical" class="form-checkbox h-5 w-5 text-indigo-600"> <span class="ml-2">Clinical Examination</span></label>
                <label class="inline-flex items-center"><input type="checkbox" name="diagnosisMethod" value="genetic" class="form-checkbox h-5 w-5 text-indigo-600"> <span class="ml-2">Genetic Testing</span></label>
                <label class="inline-flex items-center"><input type="checkbox" name="diagnosisMethod" value="biochemical" class="form-checkbox h-5 w-5 text-indigo-600"> <span class="ml-2">Biochemical Testing (e.g., blood test)</span></label>
                <label class="inline-flex items-center"><input type="checkbox" name="diagnosisMethod" value="imaging" class="form-checkbox h-5 w-5 text-indigo-600"> <span class="ml-2">Imaging (MRI, X-Ray)</span></label>
                <label class="inline-flex items-center"><input type="checkbox" name="diagnosisMethod" value="family" class="form-checkbox h-5 w-5 text-indigo-600"> <span class="ml-2">Family History</span></label>
            </div>
        </div>
         <div>
            <label for="geneInfo" class="form-label">Gene Information (if known from a genetic test)</label>
            <input type="text" id="geneInfo" name="geneInfo" class="form-input" placeholder="e.g., &quot;DMD&quot;, &quot;CFTR&quot;">
        </div>
        <div>
            <label for="secondaryDiagnosis" class="form-label">Secondary / Associated Diagnosis</label>
            <input type="text" id="secondaryDiagnosis" name="secondaryDiagnosis" class="form-input" placeholder="Enter any other associated conditions">
             <p class="helper-text">Start typing the name of the disease if you know it.</p>
        </div>
        <div>
            <label for="familyHistory" class="form-label">Family History of Condition <span class="text-red-500">*</span></label>
            <select id="familyHistory" name="familyHistory" class="form-select" required>
                <option value="">Select an Option</option>
                <option>Yes</option>
                <option>No</option>
                <option>Unknown</option>
            </select>
             <p class="helper-text">Are any other relatives (parents, siblings, aunts, uncles) affected by the same or similar condition?</p>
        </div>
         <div>
            <label for="medicalReports" class="form-label">Upload Medical Reports</label>
            <input type="file" id="medicalReports" name="medicalReports" class="form-input" multiple>
             <p class="helper-text">You can upload doctor's prescriptions / notes, genetic test reports, biomarkers / lab tests reports, discharge summaries, imaging reports. (Max 10MB, PDF, JPG, PNG, DICOM)</p>
        </div>
    </div>
</div>

<!-- Section F: Medical History -->
<div class="form-section">
    <div class="form-section-header">
        <h2 class="text-xl font-semibold text-gray-800">Section F: Medical History</h2>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
            <label for="currentDiseaseStatus" class="form-label">Current Disease Status <span class="text-red-500">*</span></label>
            <select id="currentDiseaseStatus" name="currentDiseaseStatus" class="form-select" required>
                <option value="">Select Status</option>
                <option>Stable</option>
                <option>Progressive</option>
                <option>Remission</option>
                <option>Not known</option>
            </select>
            <p class="helper-text">Please select the option which you feel is probable.</p>
        </div>
        <div>
            <label for="doctorHospital" class="form-label">Doctor and/or Hospital Managing Treatment/Care</label>
            <textarea id="doctorHospital" name="doctorHospital" rows="3" class="form-textarea" placeholder="Dr. Name, Hospital Name, City"></textarea>
             <p class="helper-text">Please share details, if any.</p>
        </div>
        <div>
            <label for="currentMedications" class="form-label">Current Medications</label>
            <textarea id="currentMedications" name="currentMedications" rows="3" class="form-textarea" placeholder="Name, dosage, start date"></textarea>
             <p class="helper-text">Please list all current medications and supplements.</p>
        </div>
        <div>
            <label for="surgeries" class="form-label">Surgeries / Procedures underwent</label>
            <textarea id="surgeries" name="surgeries" rows="3" class="form-textarea" placeholder="e.g., Heart surgery in 2021"></textarea>
             <p class="helper-text">Please share details if any.</p>
        </div>
        <div class="md:col-span-2">
            <label class="form-label">Medical Devices Used</label>
            <div class="flex flex-wrap gap-4">
                <label class="inline-flex items-center"><input type="checkbox" name="medicalDevice" value="wheelchair" class="form-checkbox h-5 w-5 text-indigo-600"> <span class="ml-2">Wheelchair/Mobility Aid</span></label>
                <label class="inline-flex items-center"><input type="checkbox" name="medicalDevice" value="ventilator" class="form-checkbox h-5 w-5 text-indigo-600"> <span class="ml-2">Ventilator/Breathing Support</span></label>
                <label class="inline-flex items-center"><input type="checkbox" name="medicalDevice" value="hearing_aid" class="form-checkbox h-5 w-5 text-indigo-600"> <span class="ml-2">Hearing Aid</span></label>
                <label class="inline-flex items-center"><input type="checkbox" name="medicalDevice" value="feeding_tube" class="form-checkbox h-5 w-5 text-indigo-600"> <span class="ml-2">Feeding Tube</span></label>
            </div>
        </div>
    </div>
</div>

<!-- Section G: Social & Support Functions -->
 <div class="form-section">
    <div class="form-section-header">
        <h2 class="text-xl font-semibold text-gray-800">Section G: Social & Support Functions needed from SFRD</h2>
        <p class="text-gray-600 mt-1">You shall be provided with necessary support as sought from the below information.</p>
    </div>
     <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
            <label for="patientOrg" class="form-label">Patient Organization Membership</label>
            <textarea id="patientOrg" name="patientOrg" rows="3" class="form-textarea" placeholder="Name of organization(s)"></textarea>
            <p class="helper-text">Please share details, if any.</p>
        </div>
        <div>
            <label for="counselling" class="form-label">Need for Counselling</label>
            <textarea id="counselling" name="counselling" rows="3" class="form-textarea" placeholder="e.g., Genetic counselling, psychological support"></textarea>
            <p class="helper-text">Please share details, if any.</p>
        </div>
         <div>
            <label for="govSchemes" class="form-label">Government Schemes availed</label>
            <textarea id="govSchemes" name="govSchemes" rows="3" class="form-textarea" placeholder="Name of the scheme(s)"></textarea>
            <p class="helper-text">Please share details, if any.</p>
        </div>
         <div>
            <label for="preferredLang" class="form-label">Preferred Language for Communication <span class="text-red-500">*</span></label>
            <select id="preferredLang" name="preferredLang" class="form-select" required>
                <option value="">Select Language</option>
                <option>English</option>
                <option>Hindi</option>
                <option>Bengali</option>
                <option>Marathi</option>
                <option>Telugu</option>
                <option>Tamil</option>
                <option>Gujarati</option>
                <option>Urdu</option>
                <option>Kannada</option>
                <option>Odia</option>
                <option>Malayalam</option>
                <option>Punjabi</option>
                <option>Assamese</option>
            </select>
        </div>
         <div>
            <label for="financialSupport" class="form-label">Need for Financial Support Navigation</label>
            <textarea id="financialSupport" name="financialSupport" rows="3" class="form-textarea" placeholder="Describe your needs"></textarea>
            <p class="helper-text">Please share details if any.</p>
        </div>
         <div>
            <label for="transportSupport" class="form-label">Need for Home /Transport Support</label>
            <textarea id="transportSupport" name="transportSupport" rows="3" class="form-textarea" placeholder="Describe your needs"></textarea>
            <p class="helper-text">Please share details if any.</p>
        </div>
    </div>
</div>

<!-- Section H: Consent for Data Use & Sharing -->
<div class="form-section">
    <div class="form-section-header">
        <h2 class="text-xl font-semibold text-gray-800">Section H: Consent for Data Use & Sharing</h2>
        <p class="text-gray-600 mt-1">Your privacy is our highest priority. This section explains how your information will be used and asks for your permission. Please read each point carefully. You can change these preferences at any time by contacting us.</p>
    </div>
    <div class="space-y-6">
        <label class="flex items-start">
            <input type="checkbox" name="consentStore" required class="form-checkbox h-5 w-5 text-indigo-600 mt-1">
            <span class="ml-3 text-sm">
                <span class="font-semibold">Consent to Store and Use Information for Support <span class="text-red-500">*</span></span><br>
                I agree that SFRD can securely store the information I have provided. I understand that the SFRD support team will use this information to contact me, provide guidance, and connect me with relevant resources.
            </span>
        </label>
         <label class="flex items-start">
            <input type="checkbox" name="consentExperts" required class="form-checkbox h-5 w-5 text-indigo-600 mt-1">
            <span class="ml-3 text-sm">
                 <span class="font-semibold">Consent for Case Review by Medical Experts <span class="text-red-500">*</span></span><br>
                I agree that a de-identified (anonymous) summary of this health information can be shared with verified medical experts within the SFRD network to help get a clinical opinion. (This means your name and contact details will be removed).
            </span>
        </label>
         <label class="flex items-start">
            <input type="checkbox" name="consentRegistry" class="form-checkbox h-5 w-5 text-indigo-600 mt-1">
            <span class="ml-3 text-sm">
                <span class="font-semibold">Consent for National Research Registry (Optional)</span><br>
                I agree that de-identified (anonymous) health data can be included in a Disease-specific Patient Registry / National Rare Disease Registry. This is vital for researchers to understand these diseases in India and work towards new treatments.
            </span>
        </label>
        <label class="flex items-start">
            <input type="checkbox" name="consentTrials" class="form-checkbox h-5 w-5 text-indigo-600 mt-1">
            <span class="ml-3 text-sm">
                <span class="font-semibold">Consent for Contact about Clinical Trials (Optional)</span><br>
                I agree to be contacted by SFRD if a clinical trial or a new research study, for which the patient might be eligible, becomes available in India.
            </span>
        </label>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 pt-4 border-t">
            <div>
                <label for="consentName" class="form-label">Full Name of Person Giving Consent <span class="text-red-500">*</span></label>
                <input type="text" id="consentName" name="consentName" class="form-input" placeholder="Please type your full name." required>
            </div>
            <div>
                <label for="consentRelation" class="form-label">Relationship to Patient <span class="text-red-500">*</span></label>
                <select id="consentRelation" name="consentRelation" class="form-select" required>
                   <option value="">Select Relationship</option>
                   <option>Self</option>
                    <option>Mother</option>
                    <option>Father</option>
                    <option>Guardian</option>
                    <option>Other</option>
                </select>
            </div>
             <div>
                <label for="consentDate" class="form-label">Date of Consent <span class="text-red-500">*</span></label>
                <input type="date" id="consentDate" name="consentDate" class="form-input bg-gray-100" readonly required>
            </div>
        </div>
         <div>
            <label for="digitalSignature" class="form-label">Digital Signature</label>
            <textarea id="digitalSignature" name="digitalSignature" rows="3" class="form-textarea" placeholder="Typing your full name here acts as your digital signature."></textarea>
        </div>
    </div>
</div>

            <div class="text-center mt-8">
                <button type="submit" class="submit-button inline-flex items-center justify-center px-8 py-4 border border-transparent text-base font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 shadow-lg transform hover:scale-105 transition-transform duration-200">
                    <svg class="-ml-1 mr-3 h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                        <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z" />
                        <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z" />
                    </svg>
                    SUBMIT SECURELY
                </button>
            </div>

        </form>
        
        <!-- SFRD Official Use Section -->
        <div class="form-section mt-12 border-t-4 border-indigo-500">
             <h2 class="text-xl font-semibold text-gray-800 mb-4">SFRD Official Use Only</h2>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div>
                    <label for="onboardingDate" class="form-label">Date of Onboarding</label>
                    <input type="date" id="onboardingDate" name="onboardingDate" class="form-input">
                </div>
                 <div>
                    <label for="staffResponsible" class="form-label">Staff Responsible</label>
                    <input type="text" id="staffResponsible" name="staffResponsible" class="form-input">
                </div>
                 <div class="md:col-span-2">
                    <label class="form-label">Verified Document Checklist</label>
                    <div class="flex flex-wrap gap-4">
                       <label class="inline-flex items-center"><input type="checkbox" name="docCheck" value="prescription" class="form-checkbox h-5 w-5 text-indigo-600"> <span class="ml-2">Doctor's Prescription/Notes</span></label>
                        <label class="inline-flex items-center"><input type="checkbox" name="docCheck" value="genetic_report" class="form-checkbox h-5 w-5 text-indigo-600"> <span class="ml-2">Genetic Test Reports</span></label>
                        <label class="inline-flex items-center"><input type="checkbox" name="docCheck" value="lab_report" class="form-checkbox h-5 w-5 text-indigo-600"> <span class="ml-2">Biomarkers/Lab Test Reports</span></label>
                        <label class="inline-flex items-center"><input type="checkbox" name="docCheck" value="discharge_summary" class="form-checkbox h-5 w-5 text-indigo-600"> <span class="ml-2">Discharge Summaries</span></label>
                        <label class="inline-flex items-center"><input type="checkbox" name="docCheck" value="imaging_report" class="form-checkbox h-5 w-5 text-indigo-600"> <span class="ml-2">Imaging Reports</span></label>
                    </div>
                </div>
                <div>
                    <label for="remarks" class="form-label">Remarks</label>
                    <textarea id="remarks" name="remarks" rows="4" class="form-textarea"></textarea>
                </div>
            </div>
        </div>

    </div>

    <script type="module">
        import { auth, db, storage, appId } from '../js/firebase-config.js';
        import { doc, setDoc, updateDoc } from 'https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js';
        import { ref, uploadBytes, getDownloadURL } from 'https://www.gstatic.com/firebasejs/9.6.10/firebase-storage.js';
        import { onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js';
        import { initializeFormEnhancements } from '../js/form-enhancements.js';
        const form = document.getElementById('patientOnboardingForm');
        let currentUserId = null;

        // --- Authentication and Initialization ---
        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUserId = user.uid;
                document.getElementById('email').value = user.email;
                document.getElementById('patientId').value = user.uid;
                document.getElementById('consentDate').valueAsDate = new Date();

                // Initialize form enhancements (e.g., autocomplete)
                initializeFormEnhancements(form, 'patientOnboardingForm', user.uid);
                
                console.log('Patient form initialized for user:', user.uid);
            } else {
                // This case is handled by auth-guard.js
            }
        });



        // --- Form Submission Logic ---
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const submitButton = form.querySelector('button[type="submit"]');
            submitButton.disabled = true;
            submitButton.textContent = 'SUBMITTING...';

            if (!currentUserId) {
                alert('Authentication error. Please sign in again.');
                submitButton.disabled = false;
                submitButton.textContent = 'SUBMIT FORM';
                return;
            }

            try {
                const formData = new FormData(form);
                const data = {
                    uid: currentUserId,
                    guardianUid: currentUserId, // Required by Firestore rules
                    createdAt: new Date().toISOString()
                };
                const checkboxGroups = {};

                formData.forEach((value, key) => {
                    const element = form.elements[key];
                     if (element && element.type === 'checkbox') {
                        if (!checkboxGroups[key]) {
                            checkboxGroups[key] = [];
                        }
                        checkboxGroups[key].push(value);
                    } else {
                        data[key] = value;
                    }
                });
                Object.assign(data, checkboxGroups);

                // Exclude the raw file input from the data to be saved in Firestore
                delete data.medicalReports;

                // Handle file uploads
                const medicalReportsInput = document.getElementById('medicalReports');
                if (medicalReportsInput.files.length > 0) {
                    const uploadPromises = Array.from(medicalReportsInput.files).map(file => {
                        const filePath = `artifacts/patient-reports/${currentUserId}/${file.name}`;
                        const fileRef = ref(storage, filePath);
                        return uploadBytes(fileRef, file).then(snapshot => getDownloadURL(snapshot.ref));
                    });
                    data.medicalReportUrls = await Promise.all(uploadPromises);
                }

                console.log('Saving patient data:', data);
                console.log('Using appId:', appId);

                // Save the detailed profile data to the correct collection path
                await setDoc(doc(db, `artifacts/${appId}/patients`, currentUserId), data);

                // Update the user's main record in the correct collection path
                const userDocRef = doc(db, `artifacts/${appId}/users`, currentUserId);
                await updateDoc(userDocRef, {
                    profileComplete: true,
                    status: 'pending_approval',
                    role: 'patient' // Explicitly set the role to 'patient'
                });

                alert('Form submitted successfully! Your profile is now under review.');
                window.location.href = '/index.html'; // Redirect to homepage

            } catch (error) {
                console.error('Error submitting form: ', error);
                alert('An error occurred. Please check the console and try again.');
                submitButton.disabled = false;
                submitButton.textContent = 'SUBMIT FORM';
            }
        });
    </script>
    <script src="https://unpkg.com/tributejs/dist/tribute.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const diseaseCollection = {
                trigger: '@',
                selectTemplate: function(item) {
                    if (typeof item === 'undefined') return null;
                    document.getElementById('orphaCode').value = item.original.OrphaCode;
                    return item.original.name;
                },
                values: function(text, cb) {
                    if (text.length < 3) return;
                    fetch(`https://api.orphadata.com/rd-lookup/diseases?query=${text}`)
                        .then(response => response.json())
                        .then(data => {
                            const results = data.results.map(d => ({ name: d.name, OrphaCode: d.OrphaCode }));
                            cb(results);
                        })
                        .catch(err => console.error(err));
                },
                menuItemTemplate: function(item) {
                    return `${item.original.name} (ORPHA:${item.original.OrphaCode})`;
                },
                noMatchTemplate: function() {
                    return '<li>No matches found</li>';
                }
            };

            const symptomCollection = {
                trigger: '#',
                selectTemplate: function(item) {
                    if (typeof item === 'undefined') return null;
                    return item.original.name;
                },
                values: function(text, cb) {
                    if (text.length < 3) return;
                    // This endpoint is a placeholder as Orphadata does not have a direct symptom search.
                    // In a real scenario, we'd use a different API or a local list.
                    // For this demo, we'll use a hardcoded list.
                    const symptoms = [
                        { name: 'Seizures' }, { name: 'Muscle weakness' }, { name: 'Scoliosis' },
                        { name: 'Cataracts' }, { name: 'Hearing loss' }, { name: 'Chronic pain' }
                    ].filter(s => s.name.toLowerCase().includes(text.toLowerCase()));
                    cb(symptoms);
                },
                menuItemTemplate: function(item) {
                    return item.original.name;
                },
                 noMatchTemplate: function() {
                    return '<li>No matches found</li>';
                }
            };

            const tributeDiseases = new Tribute({
                collection: [diseaseCollection]
            });
            tributeDiseases.attach(document.getElementById('diseaseName'));

            const tributeSymptoms = new Tribute({
                collection: [symptomCollection]
            });
            tributeSymptoms.attach(document.getElementById('otherSymptoms'));
        });
    </script>
    <script type="module" src="../js/auth-guard.js"></script>
</body>
</html>




