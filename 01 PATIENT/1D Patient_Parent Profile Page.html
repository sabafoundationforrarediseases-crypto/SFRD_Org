<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="../../public/Logo_SFRD.jpg" type="image/jpeg">
    <title>Patient/Parent Profile | Saba Foundation for Rare Diseases (SFRD)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .form-section {
            border-left: 3px solid #EF4444; /* Red-500 for patients */
            transition: all 0.3s ease-in-out;
        }
        .form-section h2 {
            color: #111827; /* gray-900 */
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Dashboard Header -->
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <nav class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-20">
                <a href="index.html" class="flex items-center space-x-2">
                    <img src="../../public/Logo_SFRD.jpg" alt="SFRD Logo" class="h-10 w-10">
                    <span class="text-xl font-bold text-gray-800">SFRD Portal</span>
                </a>
                <div class="flex items-center space-x-4">
                    <span id="user-display-name" class="font-medium hidden sm:block">Welcome!</span>
                    <button id="logout-button" class="text-sm font-semibold text-indigo-600 hover:text-indigo-800">Logout</button>
                </div>
            </div>
        </nav>
    </header>

    <main class="container mx-auto p-4 md:p-8">
        <div class="max-w-4xl mx-auto">
            <div class="bg-white rounded-lg shadow-md p-6 mb-8">
                <h1 class="text-3xl font-bold text-gray-900">Patient & Family Profile</h1>
                <p class="text-gray-600 mt-2">Welcome to your secure SFRD profile. Please complete all sections to help us understand your journey better. The more detail you provide, the better we can support you.</p>
                <div class="mt-4 w-full bg-gray-200 rounded-full h-2.5">
                    <div id="progress-bar" class="bg-indigo-600 h-2.5 rounded-full transition-all duration-500" style="width: 0%"></div>
                </div>
                <p id="progress-text" class="text-sm text-right text-gray-600 mt-1">Profile 0% Complete</p>
            </div>
            
            <form id="patient-profile-form" class="space-y-10">
                
                <!-- Section A: Referee Details -->
                <section class="bg-white p-6 rounded-lg shadow-sm form-section pl-6 fade-in">
                    <h2 class="text-2xl font-semibold mb-1">Section A: Referee Details</h2>
                    <p class="text-gray-500 mb-6">This section helps us understand who referred you to SFRD.</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="referredBy" class="block text-sm font-medium text-gray-700">Referred by</label>
                            <select id="referredBy" name="referredBy" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"><option>Self</option><option>Volunteer</option><option>NGO</option><option>Doctor</option><option>Genetic Counsellor</option><option>Diagnostics Lab</option><option>Hospital</option><option>Other</option></select>
                        </div>
                        <div>
                            <label for="refereeId" class="block text-sm font-medium text-gray-700">Unique ID of Referee (if known)</label>
                            <input type="text" id="refereeId" name="refereeId" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                        </div>
                        <div class="md:col-span-2">
                             <label for="refereeDetails" class="block text-sm font-medium text-gray-700">Details of Referee (Name, Profession, City)</label>
                             <input type="text" id="refereeDetails" name="refereeDetails" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                        </div>
                         <div>
                            <label for="refereeContact" class="block text-sm font-medium text-gray-700">Contact Phone/WhatsApp of Referee</label>
                            <input type="tel" id="refereeContact" name="refereeContact" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                        </div>
                    </div>
                </section>

                <!-- Section B: Patient's Basic Information -->
                <section class="bg-white p-6 rounded-lg shadow-sm form-section pl-6 fade-in">
                     <h2 class="text-2xl font-semibold mb-1">Section B: Patient's Basic Information</h2>
                    <p class="text-gray-500 mb-6">All personal contact information is kept strictly confidential.</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                         <div><label for="firstName" class="block text-sm font-medium text-gray-700">First Name <span class="text-red-500">*</span></label><input type="text" id="firstName" name="firstName" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></div>
                        <div><label for="lastName" class="block text-sm font-medium text-gray-700">Last Name <span class="text-red-500">*</span></label><input type="text" id="lastName" name="lastName" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></div>
                        <div><label for="dob" class="block text-sm font-medium text-gray-700">Date of Birth <span class="text-red-500">*</span></label><input type="date" id="dob" name="dob" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></div>
                        <div><label for="gender" class="block text-sm font-medium text-gray-700">Gender <span class="text-red-500">*</span></label><select id="gender" name="gender" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"><option value="">Select...</option><option value="1">Male</option><option value="2">Female</option><option value="0">Not Known</option><option value="9">Not Applicable</option></select></div>
                         <div><label for="country" class="block text-sm font-medium text-gray-700">Country of Residence</label><input type="text" id="country" name="country" value="India" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm bg-gray-100" readonly></div>
                        <div><label for="state" class="block text-sm font-medium text-gray-700">State <span class="text-red-500">*</span></label><input type="text" id="state" name="state" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></div>
                        <div><label for="city" class="block text-sm font-medium text-gray-700">City/Town/Village <span class="text-red-500">*</span></label><input type="text" id="city" name="city" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></div>
                        <div><label for="vitalStatus" class="block text-sm font-medium text-gray-700">Patient's Current Status</label><select id="vitalStatus" name="vitalStatus" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"><option>Alive</option><option>Deceased</option></select></div>
                        <div><label for="contactEmail" class="block text-sm font-medium text-gray-700">Contact Email</label><input type="email" id="contactEmail" name="contactEmail" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></div>
                        <div><label for="contactPhone" class="block text-sm font-medium text-gray-700">Contact Phone/WhatsApp</label><input type="tel" id="contactPhone" name="contactPhone" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></div>
                        <div class="md:col-span-2"><label for="socialMedia" class="block text-sm font-medium text-gray-700">Social Media Handles (Optional)</label><input type="text" id="socialMedia" name="socialMedia" placeholder="e.g., Facebook, Instagram links" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></div>
                    </div>
                </section>

                 <!-- Section C: Parental / Caregiver Information -->
                <section class="bg-white p-6 rounded-lg shadow-sm form-section pl-6 fade-in">
                    <h2 class="text-2xl font-semibold mb-1">Section C: Parental / Caregiver Information</h2>
                    <p class="text-gray-500 mb-6">This helps us reach out for all future activities. Please add at least one contact.</p>
                    <div id="parental-info-container" class="space-y-4">
                        <!-- JS will insert repeatable fields here -->
                    </div>
                    <button type="button" id="add-parent-info" class="mt-4 text-sm font-medium text-indigo-600 hover:text-indigo-500">+ Add another Parent/Caregiver</button>
                </section>

                <!-- Section D: Symptoms & Clinical Features -->
                <section class="bg-white p-6 rounded-lg shadow-sm form-section pl-6 fade-in">
                    <h2 class="text-2xl font-semibold mb-1">Section D: Symptoms & Clinical Features (Phenotype)</h2>
                    <p class="text-gray-500 mb-6">Describe the patient's health challenges. Describe symptoms even if they seem unrelated. This helps in pattern recognition.</p>
                    <div class="space-y-4">
                        <div><label for="growthDev" class="block text-sm font-medium text-gray-700">Overall Growth & Development</label><textarea id="growthDev" name="growthDev" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="Any issues with height, weight, head size, or delays in milestones like walking or talking."></textarea></div>
                        <div><label for="neurological" class="block text-sm font-medium text-gray-700">Neurological (Brain & Nerves)</label><textarea id="neurological" name="neurological" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="Any seizures, muscle weakness, difficulty with balance/coordination, or learning difficulties."></textarea></div>
                        <div><label for="skeletal" class="block text-sm font-medium text-gray-700">Skeletal (Bones & Joints)</label><textarea id="skeletal" name="skeletal" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="Any unusual bone shape, frequent fractures, joint stiffness, or scoliosis (curved spine)."></textarea></div>
                        <div><label for="cardiovascular" class="block text-sm font-medium text-gray-700">Cardiovascular (Heart & Blood)</label><textarea id="cardiovascular" name="cardiovascular" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="Any known heart defects, irregular heartbeat, or bleeding/clotting problems."></textarea></div>
                        <div><label for="eyesVision" class="block text-sm font-medium text-gray-700">Eyes & Vision</label><textarea id="eyesVision" name="eyesVision" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="Any issues like cataracts, poor vision, or unusual eye movements."></textarea></div>
                        <div><label for="otherSymptoms" class="block text-sm font-medium text-gray-700">Other Major Symptoms</label><textarea id="otherSymptoms" name="otherSymptoms" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="Any other significant symptoms related to skin, hearing, breathing, or digestion."></textarea></div>
                        <div><label for="physicalFunctioning" class="block text-sm font-medium text-gray-700">Physical Functioning</label><textarea id="physicalFunctioning" name="physicalFunctioning" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="Describe physical mobility, daily activity support needed, school/work participation."></textarea></div>
                    </div>
                </section>
                
                <!-- Section E: Diagnosis Information -->
                <section class="bg-white p-6 rounded-lg shadow-sm form-section pl-6 fade-in">
                     <h2 class="text-2xl font-semibold mb-1">Section E: Diagnosis Information</h2>
                    <p class="text-gray-500 mb-6">Please provide as much detail as you can. If you are unsure, write 'Don't Know' or upload a doctor's report.</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div><label for="diagnosisStatus" class="block text-sm font-medium text-gray-700">Diagnosis Status</label><select id="diagnosisStatus" name="diagnosisStatus" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"><option>Confirmed</option><option>Suspected</option></select></div>
                        <div><label for="diseaseName" class="block text-sm font-medium text-gray-700">Name of the Disease/Condition</label><input type="text" id="diseaseName" name="diseaseName" placeholder="Start typing the name..." class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></div>
                        <div><label for="orphaCode" class="block text-sm font-medium text-gray-700">ORPHA Code (if known)</label><input type="text" id="orphaCode" name="orphaCode" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></div>
                        <div><label for="dateOfFirstSymptoms" class="block text-sm font-medium text-gray-700">Date of First Symptoms</label><input type="date" id="dateOfFirstSymptoms" name="dateOfFirstSymptoms" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></div>
                        <div><label for="dateOfDiagnosis" class="block text-sm font-medium text-gray-700">Date of First Diagnosis</label><input type="date" id="dateOfDiagnosis" name="dateOfDiagnosis" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></div>
                        <div><label for="geneInfo" class="block text-sm font-medium text-gray-700">Gene Information (if known)</label><input type="text" id="geneInfo" name="geneInfo" placeholder="e.g., DMD, CFTR" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></div>
                        <div class="md:col-span-2"><label for="secondaryDiagnosis" class="block text-sm font-medium text-gray-700">Secondary / Associated Diagnosis</label><input type="text" id="secondaryDiagnosis" name="secondaryDiagnosis" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></div>
                        <div><label for="familyHistory" class="block text-sm font-medium text-gray-700">Family History of Condition</label><select id="familyHistory" name="familyHistory" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"><option>Yes</option><option>No</option><option>Unknown</option></select></div>
                        <div class="md:col-span-2"><label class="block text-sm font-medium text-gray-700">How was the diagnosis made?</label><div class="mt-2 grid grid-cols-2 gap-4"><div class="flex items-start"><div class="flex items-center h-5"><input name="diagMethod" type="checkbox" value="Clinical Examination" class="h-4 w-4 text-indigo-600 border-gray-300 rounded"></div><div class="ml-3 text-sm"><label class="font-medium text-gray-700">Clinical Examination</label></div></div><div class="flex items-start"><div class="flex items-center h-5"><input name="diagMethod" type="checkbox" value="Genetic Testing" class="h-4 w-4 text-indigo-600 border-gray-300 rounded"></div><div class="ml-3 text-sm"><label class="font-medium text-gray-700">Genetic Testing</label></div></div><div class="flex items-start"><div class="flex items-center h-5"><input name="diagMethod" type="checkbox" value="Biochemical Testing" class="h-4 w-4 text-indigo-600 border-gray-300 rounded"></div><div class="ml-3 text-sm"><label class="font-medium text-gray-700">Biochemical Testing</label></div></div><div class="flex items-start"><div class="flex items-center h-5"><input name="diagMethod" type="checkbox" value="Imaging" class="h-4 w-4 text-indigo-600 border-gray-300 rounded"></div><div class="ml-3 text-sm"><label class="font-medium text-gray-700">Imaging (MRI, X-Ray)</label></div></div></div></div>
                        <div class="md:col-span-2"><label for="medicalReports" class="block text-sm font-medium text-gray-700">Upload Medical Reports</label><input type="file" id="medicalReports" name="medicalReports" multiple class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100"/></div>
                    </div>
                </section>

                <!-- Section F: Medical History -->
                <section class="bg-white p-6 rounded-lg shadow-sm form-section pl-6 fade-in">
                    <h2 class="text-2xl font-semibold mb-1">Section F: Medical History</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                        <div><label for="currentDiseaseStatus" class="block text-sm font-medium text-gray-700">Current Disease Status</label><select id="currentDiseaseStatus" name="currentDiseaseStatus" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"><option>Stable</option><option>Progressive</option><option>Remission</option><option>Not Known</option></select></div>
                        <div class="md:col-span-2"><label for="managingDoctor" class="block text-sm font-medium text-gray-700">Doctor and/or Hospital Managing Treatment/Care</label><textarea id="managingDoctor" name="managingDoctor" rows="2" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></textarea></div>
                        <div class="md:col-span-2"><label for="currentMedications" class="block text-sm font-medium text-gray-700">Current Medications & Supplements</label><textarea id="currentMedications" name="currentMedications" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="Name, dosage, start date"></textarea></div>
                        <div class="md:col-span-2"><label for="surgeries" class="block text-sm font-medium text-gray-700">Surgeries / Procedures Undergone</label><textarea id="surgeries" name="surgeries" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></textarea></div>
                        <div class="md:col-span-2"><label class="block text-sm font-medium text-gray-700">Medical Devices Used</label><div class="mt-2 grid grid-cols-2 gap-4"><div class="flex items-start"><div class="flex items-center h-5"><input name="devices" type="checkbox" value="Wheelchair/Mobility Aid" class="h-4 w-4 text-indigo-600 border-gray-300 rounded"></div><div class="ml-3 text-sm"><label class="font-medium text-gray-700">Wheelchair/Mobility Aid</label></div></div><div class="flex items-start"><div class="flex items-center h-5"><input name="devices" type="checkbox" value="Ventilator/Breathing Support" class="h-4 w-4 text-indigo-600 border-gray-300 rounded"></div><div class="ml-3 text-sm"><label class="font-medium text-gray-700">Ventilator/Breathing Support</label></div></div><div class="flex items-start"><div class="flex items-center h-5"><input name="devices" type="checkbox" value="Hearing Aid" class="h-4 w-4 text-indigo-600 border-gray-300 rounded"></div><div class="ml-3 text-sm"><label class="font-medium text-gray-700">Hearing Aid</label></div></div><div class="flex items-start"><div class="flex items-center h-5"><input name="devices" type="checkbox" value="Feeding Tube" class="h-4 w-4 text-indigo-600 border-gray-300 rounded"></div><div class="ml-3 text-sm"><label class="font-medium text-gray-700">Feeding Tube</label></div></div></div></div>
                    </div>
                </section>

                <!-- Section G: Social & Support Functions -->
                <section class="bg-white p-6 rounded-lg shadow-sm form-section pl-6 fade-in">
                    <h2 class="text-2xl font-semibold mb-1">Section G: Social & Support Functions</h2>
                    <p class="text-gray-500 mb-6">Let us know what kind of support you need from the SFRD network.</p>
                     <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div><label for="patientOrgMembership" class="block text-sm font-medium text-gray-700">Patient Organization Membership (if any)</label><input type="text" id="patientOrgMembership" name="patientOrgMembership" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></div>
                        <div><label for="preferredLanguage" class="block text-sm font-medium text-gray-700">Preferred Language for Communication</label><input type="text" id="preferredLanguage" name="preferredLanguage" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></div>
                        <div class="md:col-span-2"><label for="counsellingNeed" class="block text-sm font-medium text-gray-700">Need for Counselling</label><textarea id="counsellingNeed" name="counsellingNeed" rows="2" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="Please share details, if any."></textarea></div>
                        <div class="md:col-span-2"><label for="govtSchemes" class="block text-sm font-medium text-gray-700">Government Schemes Availed</label><textarea id="govtSchemes" name="govtSchemes" rows="2" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="Please share details, if any."></textarea></div>
                        <div class="md:col-span-2"><label for="financialSupportNeed" class="block text-sm font-medium text-gray-700">Need for Financial Support Navigation</label><textarea id="financialSupportNeed" name="financialSupportNeed" rows="2" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="Please share details, if any."></textarea></div>
                        <div class="md:col-span-2"><label for="transportSupportNeed" class="block text-sm font-medium text-gray-700">Need for Home / Transport Support</label><textarea id="transportSupportNeed" name="transportSupportNeed" rows="2" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" placeholder="Please share details, if any."></textarea></div>
                    </div>
                </section>

                <!-- Section H: Consent -->
                <section class="bg-white p-6 rounded-lg shadow-sm form-section pl-6 fade-in">
                    <h2 class="text-2xl font-semibold mb-1">Section H: Consent for Data Use & Sharing</h2>
                    <p class="text-gray-500 mb-6">Your privacy is our highest priority. You can change these preferences at any time.</p>
                    <div class="space-y-5">
                        <div class="relative flex items-start"><div class="flex items-center h-5"><input id="consent-support" name="consentSupport" type="checkbox" required class="h-4 w-4 text-indigo-600 border-gray-300 rounded"></div><div class="ml-3 text-sm"><label for="consent-support" class="font-medium text-gray-700">Consent to Store and Use Information for Support <span class="text-red-500">*</span></label><p class="text-gray-500">I agree that SFRD can securely store my information to contact me and connect me with resources.</p></div></div>
                        <div class="relative flex items-start"><div class="flex items-center h-5"><input id="consent-review" name="consentReview" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded"></div><div class="ml-3 text-sm"><label for="consent-review" class="font-medium text-gray-700">Consent for Case Review by Medical Experts</label><p class="text-gray-500">I agree that a de-identified (anonymous) summary can be shared with verified experts to get a clinical opinion.</p></div></div>
                        <div class="relative flex items-start"><div class="flex items-center h-5"><input id="consent-registry" name="consentRegistry" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded"></div><div class="ml-3 text-sm"><label for="consent-registry" class="font-medium text-gray-700">Consent for National Research Registry</label><p class="text-gray-500">I agree that de-identified data can be included in a National Registry to help researchers.</p></div></div>
                        <div class="relative flex items-start"><div class="flex items-center h-5"><input id="consent-trials" name="consentTrials" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded"></div><div class="ml-3 text-sm"><label for="consent-trials" class="font-medium text-gray-700">Consent for Contact about Clinical Trials</label><p class="text-gray-500">I agree to be contacted by SFRD if a relevant clinical trial becomes available.</p></div></div>
                        <div class="pt-4 grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div><label for="consentName" class="block text-sm font-medium text-gray-700">Full Name of Person Giving Consent <span class="text-red-500">*</span></label><input type="text" id="consentName" name="consentName" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></div>
                            <div><label for="consentRelation" class="block text-sm font-medium text-gray-700">Relationship to Patient <span class="text-red-500">*</span></label><input type="text" id="consentRelation" name="consentRelation" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></div>
                        </div>
                    </div>
                </section>


                <div class="flex justify-end pt-8">
                    <button type="submit" id="submit-button" class="w-full md:w-auto inline-flex justify-center py-3 px-8 border border-transparent shadow-sm text-base font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700">
                        Save Profile
                    </button>
                </div>
            </form>
        </div>
    </main>

    <!-- Modal for messages -->
    <div id="message-modal" class="hidden fixed z-50 inset-0 overflow-y-auto">
        <!-- ... modal html ... -->
    </div>

    <script type="module">
        // Firebase SDKs
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";

        // Firebase Config
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-sfrd-app';
        
        let app, auth, db, storage;
        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
            storage = getStorage(app);
        } catch (e) {
            console.error("Firebase init error", e);
            alert("Could not connect to services. Please try again later.");
        }

        const userDisplayName = document.getElementById('user-display-name');
        const logoutButton = document.getElementById('logout-button');
        const form = document.getElementById('patient-profile-form');
        const submitButton = document.getElementById('submit-button');
        const parentInfoContainer = document.getElementById('parental-info-container');
        const addParentButton = document.getElementById('add-parent-info');

        let currentUser = null;
        let parentCount = 0;

        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                userDisplayName.textContent = `Welcome, ${user.displayName || user.email}`;
                userDisplayName.classList.remove('hidden');
                loadProfileData(user.uid);
            } else {
                // The syntax error occurs because in this sandboxed environment,
                // 'login.html' is not a full URL. In a real multi-page website,
                // this relative path would work correctly.
                // For this environment, we will log to console instead of redirecting.
                console.log("User not logged in. In a live site, would redirect to login.html");
                // window.location.href = 'login.html'; 
            }
        });
        
        // ... rest of the javascript ...
        
        lucide.createIcons();
    </script>
</body>
</html>

