<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tertiary Care Hospital Partnership Onboarding | Saba Foundation for Rare Diseases (SFRD)</title>
    <link rel="icon" href="../../public/Logo_SFRD.jpg" type="image/jpeg">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/validation-styles.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .form-section {
            border-left: 3px solid #4F46E5; /* Indigo-600 for Hospitals/Institutions */
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto p-4 md:p-8 max-w-4xl">
        
        <!-- Header -->
        <header class="text-center mb-8">
            <div class="inline-block mx-auto">
                 <svg class="h-16 w-16 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 21h19.5m-18-18v18m10.5-18v18m6-13.5V21M6.75 6.75h.75m-.75 3h.75m-.75 3h.75m3-6h.75m-.75 3h.75m-.75 3h.75M9 21v-3.375c0-.621.504-1.125 1.125-1.125h3.75c.621 0 1.125.504 1.125 1.125V21" />
                </svg>
            </div>
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900 mt-2">Tertiary Care Hospital Partnership Onboarding</h1>
            <p class="text-gray-600 mt-2">Joining forces to build a national alliance for rare disease care.</p>
        </header>

        <!-- Main Form -->
        <form id="hospital-onboarding-form" class="space-y-12">

            <!-- Section A: Institutional Identity -->
            <section class="bg-white p-6 rounded-lg shadow-sm form-section pl-6">
                <h2 class="text-2xl font-semibold text-gray-800 mb-1">Section A: Institutional Identity & Contact</h2>
                <p class="text-gray-500 mb-6">This information will create your institution's profile in our National Care Alliance.</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="md:col-span-2">
                        <label for="hospitalName" class="block text-sm font-medium text-gray-700">Full Legal Name of Hospital <span class="text-red-500">*</span></label>
                        <input type="text" id="hospitalName" name="hospitalName" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                    </div>
                    <div>
                        <label for="institutionType" class="block text-sm font-medium text-gray-700">Type of Institution</label>
                        <select id="institutionType" name="institutionType" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                            <option>Private</option>
                            <option>Government</option>
                            <option>Trust-run</option>
                            <option>Public-Private Partnership</option>
                        </select>
                    </div>
                    <div>
                        <label for="inceptionDate" class="block text-sm font-medium text-gray-700">Date of Inception</label>
                        <input type="date" id="inceptionDate" name="inceptionDate" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                    </div>
                     <div class="md:col-span-2">
                        <label for="websiteUrl" class="block text-sm font-medium text-gray-700">Official Website URL</label>
                        <input type="url" id="websiteUrl" name="websiteUrl" placeholder="https://www.yourhospital.com" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                    </div>
                     <div class="md:col-span-2">
                        <label for="hqAddress" class="block text-sm font-medium text-gray-700">Headquarters Address <span class="text-red-500">*</span></label>
                        <textarea id="hqAddress" name="hqAddress" rows="3" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"></textarea>
                    </div>
                    <div>
                        <label for="nodalOfficerName" class="block text-sm font-medium text-gray-700">Nodal Officer for SFRD Partnership <span class="text-red-500">*</span></label>
                        <input type="text" id="nodalOfficerName" name="nodalOfficerName" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                    </div>
                    <div>
                        <label for="nodalOfficerDesignation" class="block text-sm font-medium text-gray-700">Nodal Officer's Designation <span class="text-red-500">*</span></label>
                        <input type="text" id="nodalOfficerDesignation" name="nodalOfficerDesignation" placeholder="e.g., Medical Superintendent" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                    </div>
                    <div>
                        <label for="officialEmail" class="block text-sm font-medium text-gray-700">Official Contact Email <span class="text-red-500">*</span></label>
                        <input type="email" id="officialEmail" name="officialEmail" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                    </div>
                    <div>
                        <label for="officialPhone" class="block text-sm font-medium text-gray-700">Official Contact Phone <span class="text-red-500">*</span></label>
                        <input type="tel" id="officialPhone" name="officialPhone" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                    </div>
                </div>
            </section>

             <!-- Section B: Legal, Structural & Accreditations -->
            <section class="bg-white p-6 rounded-lg shadow-sm form-section pl-6">
                 <h2 class="text-2xl font-semibold text-gray-800 mb-1">Section B: Legal, Structural & Accreditations</h2>
                 <p class="text-gray-500 mb-6">This information helps us understand your hospital's governance and quality standards.</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                     <div>
                        <label class="block text-sm font-medium text-gray-700">Accreditations</label>
                        <div class="mt-2 space-y-2">
                             <div class="flex items-start"><div class="flex items-center h-5"><input name="accreditations" type="checkbox" value="NABH" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded"></div><div class="ml-3 text-sm"><label class="font-medium text-gray-700">NABH</label></div></div>
                             <div class="flex items-start"><div class="flex items-center h-5"><input name="accreditations" type="checkbox" value="NABL" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded"></div><div class="ml-3 text-sm"><label class="font-medium text-gray-700">NABL</label></div></div>
                             <div class="flex items-start"><div class="flex items-center h-5"><input name="accreditations" type="checkbox" value="JCI" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded"></div><div class="ml-3 text-sm"><label class="font-medium text-gray-700">JCI</label></div></div>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Tax Exemption Status</label>
                        <div class="mt-2 space-y-2">
                             <div class="flex items-start"><div class="flex items-center h-5"><input name="taxStatus" type="checkbox" value="12A" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded"></div><div class="ml-3 text-sm"><label class="font-medium text-gray-700">12A</label></div></div>
                             <div class="flex items-start"><div class="flex items-center h-5"><input name="taxStatus" type="checkbox" value="80G" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded"></div><div class="ml-3 text-sm"><label class="font-medium text-gray-700">80G</label></div></div>
                             <div class="flex items-start"><div class="flex items-center h-5"><input name="taxStatus" type="checkbox" value="FCRA" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded"></div><div class="ml-3 text-sm"><label class="font-medium text-gray-700">FCRA</label></div></div>
                        </div>
                    </div>
                    <div class="md:col-span-2">
                        <label for="legalDocs" class="block text-sm font-medium text-gray-700">Upload Key Documents (By-laws, MoA, etc.)</label>
                        <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md">
                            <div class="space-y-1 text-center">
                                <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true"><path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></svg>
                                <div class="flex text-sm text-gray-600">
                                    <label for="legalDocs" class="relative cursor-pointer bg-white rounded-md font-medium text-indigo-600 hover:text-indigo-500 focus-within:outline-none">
                                        <span>Upload files</span>
                                        <input id="legalDocs" name="legalDocs" type="file" class="sr-only" multiple>
                                    </label>
                                    <p class="pl-1">or drag and drop</p>
                                </div>
                                <p class="text-xs text-gray-500">PDF up to 5MB each</p>
                                <p id="file-upload-names-legal" class="text-xs text-indigo-700 font-semibold"></p>
                            </div>
                        </div>
                    </div>
                    <div class="md:col-span-2">
                         <label for="geographicalPresence" class="block text-sm font-medium text-gray-700">Geographical Presence</label>
                         <textarea id="geographicalPresence" name="geographicalPresence" rows="2" placeholder="If you have multiple branches, please list the cities/states." class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"></textarea>
                    </div>
                </div>
            </section>

             <!-- Section C: Operational Capacity & Expertise -->
            <section class="bg-white p-6 rounded-lg shadow-sm form-section pl-6">
                 <h2 class="text-2xl font-semibold text-gray-800 mb-1">Section C: Operational Capacity & Expertise</h2>
                <p class="text-gray-500 mb-6">Help us understand the scale and scope of your clinical services.</p>
                 <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                     <div>
                        <label for="bedCapacity" class="block text-sm font-medium text-gray-700">Total Bed Capacity</label>
                        <input type="number" id="bedCapacity" name="bedCapacity" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                    </div>
                     <div>
                        <label for="staffCount" class="block text-sm font-medium text-gray-700">Number of Full-Time Staff</label>
                        <input type="number" id="staffCount" name="staffCount" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                    </div>
                    <div class="md:col-span-2">
                         <label for="medicalSpecialities" class="block text-sm font-medium text-gray-700">List of Medical Specialities</label>
                        <select id="medicalSpecialities" name="medicalSpecialities" multiple class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                            <!-- Options will be populated by JavaScript -->
                        </select>
                    </div>
                     <div class="md:col-span-2">
                         <label for="advancedEquipment" class="block text-sm font-medium text-gray-700">Advanced Equipment & Facilities</label>
                        <textarea id="advancedEquipment" name="advancedEquipment" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" placeholder="Mention key equipment relevant to complex diseases."></textarea>
                    </div>
                    <div class="md:col-span-2">
                         <label for="futurePlans" class="block text-sm font-medium text-gray-700">Future Plans / Expansions</label>
                        <textarea id="futurePlans" name="futurePlans" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" placeholder="Share upcoming plans for new departments, technologies, etc."></textarea>
                    </div>
                </div>
            </section>
            
            <!-- Section D: Partnership Commitments -->
            <section class="bg-white p-6 rounded-lg shadow-sm form-section pl-6">
                <h2 class="text-2xl font-semibold text-gray-800 mb-1">Section D: The SFRD Partnership</h2>
                <p class="text-gray-500 mb-6">Our partnership is centered on a mutual commitment to build a rare disease vertical.</p>
                <div class="space-y-5">
                    <div class="relative flex items-start"><div class="flex items-center h-5"><input name="commitments" type="checkbox" required value="Capacity Building" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded"></div><div class="ml-3 text-sm"><label class="font-medium text-gray-700">**Capacity Building:** We agree to partner with SFRD on training programs for our staff. <span class="text-red-500">*</span></label></div></div>
                    <div class="relative flex items-start"><div class="flex items-center h-5"><input name="commitments" type="checkbox" required value="Priority Care" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded"></div><div class="ml-3 text-sm"><label class="font-medium text-gray-700">**Priority Care:** We agree to establish a protocol to treat SFRD-referred patients on a priority basis. <span class="text-red-500">*</span></label></div></div>
                    <div class="relative flex items-start"><div class="flex items-center h-5"><input name="commitments" type="checkbox" required value="Digital Integration" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded"></div><div class="ml-3 text-sm"><label class="font-medium text-gray-700">**Digital Integration:** We agree to assign a nodal officer to coordinate via the SFRD Network. <span class="text-red-500">*</span></label></div></div>
                    
                    <div class="pt-2">
                        <div class="relative flex items-start">
                            <div class="flex items-center h-5"><input id="concessional-commitment" name="commitments" type="checkbox" required value="Concessional Services" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded"></div>
                            <div class="ml-3 text-sm"><label for="concessional-commitment" class="font-medium text-gray-700">**Concessional Services:** We agree to offer a preferential discounted rate for SFRD-referred patients. <span class="text-red-500">*</span></label></div>
                        </div>
                        <div class="mt-2 ml-8">
                             <label for="rateCard" class="block text-sm font-medium text-gray-700">Upload Rate Card or Specify Discount</label>
                             <input type="file" id="rateCard" name="rateCard" class="mt-1 text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100"/>
                             <input type="text" id="discountDetails" name="discountDetails" placeholder="Or specify discount e.g., 25% on all services" class="mt-2 block w-full md:w-2/3 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                        </div>
                    </div>

                    <div class="pt-4">
                        <label class="block text-sm font-medium text-gray-700">How else can we collaborate?</label>
                        <div class="mt-2 grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="flex items-start"><div class="flex items-center h-5"><input name="collaborations" type="checkbox" value="Joint Health Camps" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded"></div><div class="ml-3 text-sm"><label class="font-medium text-gray-700">Joint Diagnostic & Health Camps</label></div></div>
                            <div class="flex items-start"><div class="flex items-center h-5"><input name="collaborations" type="checkbox" value="Research & Clinical Trials" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded"></div><div class="ml-3 text-sm"><label class="font-medium text-gray-700">Research & Clinical Trials</label></div></div>
                            <div class="flex items-start"><div class="flex items-center h-5"><input name="collaborations" type="checkbox" value="Policy Advocacy" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded"></div><div class="ml-3 text-sm"><label class="font-medium text-gray-700">Policy Advocacy</label></div></div>
                            <div class="flex items-start"><div class="flex items-center h-5"><input name="collaborations" type="checkbox" value="Patient Education" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded"></div><div class="ml-3 text-sm"><label class="font-medium text-gray-700">Patient Education</label></div></div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Section E: Consent & Formal Agreement -->
            <section class="bg-white p-6 rounded-lg shadow-sm form-section pl-6">
                <h2 class="text-2xl font-semibold text-gray-800 mb-1">Section E: Consent & Formal Agreement</h2>
                <p class="text-gray-500 mb-6">Please have an authorized representative complete this section to formalize our partnership.</p>
                <div class="space-y-5">
                    <div class="relative flex items-start"><div class="flex items-center h-5"><input name="consent" type="checkbox" required class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded"></div><div class="ml-3 text-sm"><label class="font-medium text-gray-700">I confirm I am an authorized representative of this hospital. <span class="text-red-500">*</span></label></div></div>
                    <div class="relative flex items-start"><div class="flex items-center h-5"><input name="consent" type="checkbox" required class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded"></div><div class="ml-3 text-sm"><label class="font-medium text-gray-700">I understand this partnership is voluntary and can be ended with 60 days' written notice. <span class="text-red-500">*</span></label></div></div>
                    <div class="relative flex items-start"><div class="flex items-center h-5"><input name="consent" type="checkbox" required class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded"></div><div class="ml-3 text-sm"><label class="font-medium text-gray-700">I consent to SFRD storing our information and listing us as a trusted Care Partner. <span class="text-red-500">*</span></label></div></div>
                    <div class="relative flex items-start"><div class="flex items-center h-5"><input name="consent" type="checkbox" required class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded"></div><div class="ml-3 text-sm"><label class="font-medium text-gray-700">We agree to handle all patient data with the strictest confidentiality. <span class="text-red-500">*</span></label></div></div>
                    <div class="relative flex items-start"><div class="flex items-center h-5"><input name="consentFinal" type="checkbox" required class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded"></div><div class="ml-3 text-sm"><label class="font-medium text-gray-700">By checking this box, I confirm all information is accurate and we agree to the partnership terms. <span class="text-red-500">*</span></label></div></div>
                     <div class="pt-4 grid grid-cols-1 md:grid-cols-2 gap-6">
                         <div>
                            <label for="authRepName" class="block text-sm font-medium text-gray-700">Full Name of Authorized Representative <span class="text-red-500">*</span></label>
                            <input type="text" id="authRepName" name="authRepName" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                        </div>
                        <div>
                            <label for="authRepDesignation" class="block text-sm font-medium text-gray-700">Designation <span class="text-red-500">*</span></label>
                            <input type="text" id="authRepDesignation" name="authRepDesignation" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                        </div>
                    </div>
                </div>
            </section>

            <!-- Submission Button -->
            <div class="pt-5">
                <div class="flex justify-end">
                    <button type="submit" id="submit-button" class="w-full md:w-auto ml-3 inline-flex justify-center py-3 px-8 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        Submit Partnership Form
                    </button>
                </div>
            </div>

        </form>
    </div>

    <!-- Modal for messages -->
    <div id="message-modal" class="hidden fixed z-10 inset-0 overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
       <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div id="modal-icon-container" class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full sm:mx-0 sm:h-10 sm:w-10"></div>
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                            <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title"></h3>
                            <div class="mt-2">
                                <p class="text-sm text-gray-500" id="modal-message"></p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="button" id="modal-close-button" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none sm:ml-3 sm:w-auto sm:text-sm">OK</button>
                </div>
            </div>
        </div>
    </div>

    <script src="../00 GLOBAL/firebase-config.js"></script>
    <script src="../js/common-form-logic.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore, doc, setDoc, updateDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";

        let app, auth, db, storage, currentUser;

        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
            storage = getStorage(app);
        } catch (e) {
            console.error("Firebase init error", e);
            showMessage('Error', 'Could not connect to services. Please try again later.', 'error');
        }

        const form = document.getElementById('hospital-onboarding-form');
        const submitButton = document.getElementById('submit-button');
        const legalDocsInput = document.getElementById('legalDocs');
        const rateCardInput = document.getElementById('rateCard');
        const fileUploadNamesLegal = document.getElementById('file-upload-names-legal');
        const localStorageKey = 'hospitalOnboardingForm';

        const officialEmailInput = document.getElementById('officialEmail');
        const officialPhoneInput = document.getElementById('officialPhone');

        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                console.log("User authenticated, proceeding with Hospital form.");
                if (!officialEmailInput.value && currentUser.email) {
                    officialEmailInput.value = currentUser.email;
                }
            } else {
                console.log("No user logged in, redirecting to login page.");
                window.location.href = `../00 GLOBAL/00-8 Login.html?redirect=${encodeURIComponent(window.location.href)}`;
            }
        });

        const specializationSelect = document.getElementById('medicalSpecialities');
        const specializations = [
            { value: 'Rare abdominal surgical disease', label: 'Rare abdominal surgical disease' },
            { value: 'Rare bone disease', label: 'Rare bone disease' },
            { value: 'Rare cardiac disease', label: 'Rare cardiac disease' },
            { value: 'Rare circulatory system disease', label: 'Rare circulatory system disease' },
            { value: 'Rare developmental defect during embryogenesis', label: 'Rare developmental defect during embryogenesis' },
            { value: 'Rare disorder due to toxic effects', label: 'Rare disorder due to toxic effects' },
            { value: 'Rare disorder with RCH resources uncovered otherwise', label: 'Rare disorder with RCH resources uncovered otherwise' },
            { value: 'Rare endocrine disease', label: 'Rare endocrine disease' },
            { value: 'Rare gastroenterologic disease', label: 'Rare gastroenterologic disease' },
            { value: 'Rare genetic disease', label: 'Rare genetic disease' },
            { value: 'Rare gynecologic or obstetric disease', label: 'Rare gynecologic or obstetric disease' },
            { value: 'Rare hematologic disease', label: 'Rare hematologic disease' },
            { value: 'Rare hepatic disease', label: 'Rare hepatic disease' },
            { value: 'Rare immune disease', label: 'Rare immune disease' },
            { value: 'Rare inborn errors of metabolism', label: 'Rare inborn errors of metabolism' },
            { value: 'Rare infectious disease', label: 'Rare infectious disease' },
            { value: 'Rare infertility', label: 'Rare infertility' },
            { value: 'Rare maxillo-facial surgical disease', label: 'Rare maxillo-facial surgical disease' },
            { value: 'Rare neoplastic disease', label: 'Rare neoplastic disease' },
            { value: 'Rare neurologic disease', label: 'Rare neurologic disease' },
            { value: 'Rare neurologic disease with psychiatric involvement', label: 'Rare neurologic disease with psychiatric involvement' },
            { value: 'Rare odontologic disease', label: 'Rare odontologic disease' },
            { value: 'Rare ophthalmic disorder', label: 'Rare ophthalmic disorder' },
            { value: 'Rare otorhinolaryngologic disease', label: 'Rare otorhinolaryngologic disease' },
            { value: 'Rare renal disease', label: 'Rare renal disease' },
            { value: 'Rare respiratory disease', label: 'Rare respiratory disease' },
            { value: 'Rare skin disease', label: 'Rare skin disease' },
            { value: 'Rare surgical cardiac disease', label: 'Rare surgical cardiac disease' },
            { value: 'Rare surgical thoracic disease', label: 'Rare surgical thoracic disease' },
            { value: 'Rare systemic or rheumatologic disease', label: 'Rare systemic or rheumatologic disease' },
            { value: 'Rare urogenital disease', label: 'Rare urogenital disease' },
            { value: 'Other', label: 'Other' }
        ];
        const choices = new Choices(specializationSelect, {
            choices: specializations,
            removeItemButton: true,
            searchEnabled: true,
            placeholder: true,
            placeholderValue: 'Select one or more specializations...',
        });

        document.addEventListener('DOMContentLoaded', (event) => {
            loadFormProgress();
            officialEmailInput.addEventListener('input', () => {
                if (officialEmailInput.readOnly) return;
                if (!isValidEmail(officialEmailInput.value)) {
                    showValidationError(officialEmailInput, 'Please enter a valid email address.');
                } else {
                    clearValidationError(officialEmailInput);
                }
            });
            officialPhoneInput.addEventListener('input', () => {
                if (!isValidPhone(officialPhoneInput.value)) {
                    showValidationError(officialPhoneInput, 'Please enter a valid 10-digit phone number.');
                } else {
                    clearValidationError(officialPhoneInput);
                }
            });
            legalDocsInput.addEventListener('change', () => {
                updateFileInputLabel(legalDocsInput, fileUploadNamesLegal);
            });
            form.addEventListener('input', saveFormProgress);
        });

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!currentUser) {
                showMessage('Error', 'You are not logged in. Please log in to submit the form.', 'error');
                return;
            }

            setSubmitButtonState(submitButton, true, 'Submitting...');

            if (!validateForm()) {
                showMessage('Error', 'Please fix the errors before submitting.', 'error');
                setSubmitButtonState(submitButton, false, 'Submit Partnership Form');
                return;
            }

            try {
                const uploadFiles = async (files, path) => {
                    const urls = [];
                    for (const file of files) {
                        const storageRef = ref(storage, `artifacts/${appId}/${path}/${currentUser.uid}_${file.name}`);
                        const snapshot = await uploadBytes(storageRef, file);
                        urls.push({ name: file.name, url: await getDownloadURL(snapshot.ref) });
                    }
                    return urls;
                };

                const legalDocUrls = await uploadFiles(legalDocsInput.files, 'hospital-legal-docs');
                const rateCardUrls = await uploadFiles(rateCardInput.files, 'hospital-rate-cards');

                const formData = new FormData(form);
                const hospitalData = {};
                const multiSelects = ['accreditations', 'taxStatus', 'commitments', 'collaborations'];
                multiSelects.forEach(name => hospitalData[name] = []);

                formData.forEach((value, key) => {
                    if (multiSelects.includes(key) && form.querySelector(`input[name="${key}"][value="${value}"]`).checked) {
                        hospitalData[key].push(value);
                    } else if (form.elements[key].type !== 'file' && !key.startsWith('consent')) {
                        hospitalData[key] = value;
                    }
                });

                hospitalData.consentFinal = form.elements.consentFinal.checked;
                hospitalData.medicalSpecialities = choices.getValue(true);
                hospitalData.legalDocUrls = legalDocUrls;
                hospitalData.rateCardUrl = rateCardUrls.length > 0 ? rateCardUrls[0] : null;
                hospitalData.uid = currentUser.uid;
                hospitalData.createdAt = serverTimestamp();
                hospitalData.profileStatus = 'pending_review';

                const hospitalDocRef = doc(db, `artifacts/${appId}/hospitals`, currentUser.uid);
                await setDoc(hospitalDocRef, hospitalData);

                const userDocRef = doc(db, `artifacts/${appId}/users`, currentUser.uid);
                await updateDoc(userDocRef, {
                    profileComplete: true,
                    status: 'pending_review'
                });

                showMessage('Success!', 'Your partnership form has been submitted. Our team will be in touch shortly.');
                form.reset();
                choices.clearStore();
                localStorage.removeItem(localStorageKey);

                setTimeout(() => {
                    window.location.href = '../00 GLOBAL/00-9 Pending Approval.html';
                }, 3000);

            } catch (error) {
                console.error("Error submitting form: ", error);
                showMessage('Submission Error', `There was an error: ${error.message}`, 'error');
            } finally {
                setSubmitButtonState(submitButton, false, 'Submit Partnership Form');
            }
        });

        function showMessage(title, message, type = 'success') {
            const modal = document.getElementById('message-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalMessage = document.getElementById('modal-message');
            const iconContainer = document.getElementById('modal-icon-container');

            modalTitle.textContent = title;
            modalMessage.textContent = message;

            if (type === 'success') {
                iconContainer.className = 'mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-indigo-100 sm:mx-0 sm:h-10 sm:w-10';
                iconContainer.innerHTML = `<svg class="h-6 w-6 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>`;
            } else { // error
                iconContainer.className = 'mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10';
                iconContainer.innerHTML = `<svg class="h-6 w-6 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>`;
            }
            modal.classList.remove('hidden');
        }

        document.getElementById('modal-close-button').addEventListener('click', () => {
            document.getElementById('message-modal').classList.add('hidden');
        });
    </script>
</body>
</html>
